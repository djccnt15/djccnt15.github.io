---
published: true
layout: post

title: '[ì „ì²˜ë¦¬] data scaling'
description: >
    ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ scalerë“¤
hide_description: false
image:
    path: /assets/img/posts/plot_Scaled.png
related_posts:
    - _posts/data_science/2022-07-11-scalers.md

categories:
    - data_science
tags:
    - data science
    - python
    - sklearn
---
* toc
{:toc}

## ê°œìš”

ë°ì´í„°ì˜ ì „ì²˜ë¦¬ ê³¼ì • ì¤‘ì— **scaling**ì´ë¼ëŠ” ë‹¨ê³„ê°€ ìˆë‹¤. ë°ì´í„° ë¶„ì„ì˜ ê·¼ë³¸ì´ë¼í•  ìˆ˜ ìˆëŠ” í†µê³„í•™ì—ì„œëŠ” **[ì •ê·œí™”(Normalization)](https://en.wikipedia.org/wiki/Normalization_(statistics))**ë¼ëŠ” ìš©ì–´ë¡œ ë¶€ë¥´ëŠ”ë°, ì´ ë¸”ë¡œê·¸ì—ì„œëŠ” ML ë¶„ì•¼ì—ì„œ ë§ì´ ì‚¬ìš©í•˜ëŠ” `scikit-learn` ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìš©ë¡€ì— ë”°ë¼ [scaling](https://scikit-learn.org/stable/modules/preprocessing.html#standardization-or-mean-removal-and-variance-scaling)ì´ë¼ê³  ë¶€ë¥´ê¸°ë¡œ í•œë‹¤.  

ì°¸ê³ ë¡œ `scikit-learn` ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ L1/L2 Regularizationì„ [normalization](https://scikit-learn.org/stable/modules/preprocessing.html#normalization)ì´ë¼ê³  ë¶€ë¥´ê³  ìˆë‹¤.  

**data scaling**ì„ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ë©´ ë°ì´í„°ì˜ ë‹¨ìœ„ ì°¨ì´ì— ë”°ë¥¸ ëª¨ë¸ì˜ ì™œê³¡ê³¼ ì„±ëŠ¥ ì €í•˜ë¥¼ ë§‰ê¸° ìœ„í•œ ì „ì²˜ë¦¬ë¡œ, ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ë“¤ì´ ìˆì–´ ì •ë¦¬í•´ë‘”ë‹¤.  

|ì´ë¦„|ì„¤ëª…|
|-|-|
|StandardScaler|í‰ê· ê³¼ í‘œì¤€í¸ì°¨ë¥¼ í†µí•œ í‘œì¤€ì •ê·œí™”|
|MinMaxScaler|ìµœëŒ€, ìµœì†Œê°’ì´ ê°ê° 1, 0ì´ ë˜ë„ë¡ ìŠ¤ì¼€ì¼ë§|
|MaxAbsScaler|ìµœëŒ€ì ˆëŒ€ê°’ê³¼ 0ì´ ê°ê° 1, 0ì´ ë˜ë„ë¡ ìŠ¤ì¼€ì¼ë§|
|RobustScaler|ì¤‘ì•™ê°’(median)ê³¼ IQR(interquartile range) ì‚¬ìš©. ì•„ì›ƒë¼ì´ì–´ì˜ ì˜í–¥ì„ ìµœì†Œí™”|

## ì˜ˆì œ ë°ì´í„°

ì•„ë˜ì™€ ê°™ì´ ì´ìƒì¹˜ê°€ ì”ëœ© í¬í•¨ëœ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ë³´ì.  

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

np.random.seed(30)

df = pd.DataFrame({
    'x1': np.concatenate([np.random.normal(20, 1, 9000), np.random.normal(40, 1, 1000)]),
    'x2': np.concatenate([np.random.normal(30, 2, 9000), np.random.normal(10, 4, 1000)])
})

print(df.describe())
```
```
                 x1            x2
count  10000.000000  10000.000000
mean      22.006365     28.001690
std        6.089750      6.458527
min       15.805688     -4.077173
25%       19.420740     28.083654
50%       20.152711     29.726212
75%       20.961248     31.200478
max       42.820763     38.087098
```

ë°ì´í„°ì˜ ë¶„í¬ë¥¼ ì‹œê°í™”í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.  

```python
def plotting(df, i, title):
    if i % 3 == 0:
        ax.boxplot(df)
        ax.set_xticks(ticks=[1, 2], labels=df.columns)
    elif i % 3 == 1:
        ax.violinplot(df)
        ax.set_xticks(ticks=[1, 2], labels=df.columns)
        ax.set_title(title)
    elif i % 3 == 2:
        c1 = 'g'
        c2 = 'b'
        sns.kdeplot(x=df['x1'], ax=ax, shade=True, color=c1, label='x1')
        sns.kdeplot(x=df['x2'], ax=ax, shade=True, color=c2, label='x2')
        ax.axvline(x=df['x1'].median(), linestyle='--', linewidth=0.5, color=c1)
        ax.axvline(x=df['x2'].median(), linestyle='--', linewidth=0.5, color=c2)
        ax.legend()
    ax.set_xlabel('')
    ax.set_ylabel('')

# plotting raw data
fig, axes = plt.subplots(nrows=1, ncols=3, figsize=(15, 5))
for i, ax in enumerate(axes):
    plotting(df, i, 'Raw data')

plt.show()
```

![plot_rawdata](/assets/img/posts/plot_Raw_data.png)
{:.text-center}

## StandardScaler

**StandardScaler**ëŠ” ë°ì´í„°ê°€ ì •ê·œë¶„í¬ë¥¼ ë”°ë¥¸ë‹¤ëŠ” ê°€ì •í•˜ì— í‘œì¤€ì •ê·œí™”(í‘œì¤€í™”, standardization)í•˜ëŠ” ë°©ë²•ë¡ ìœ¼ë¡œ, ì¤‘ì‹¬ê·¹í•œì •ë¦¬ì— ë”°ë¼ ëª¨ë“  ë°ì´í„°ëŠ” í‘œì¤€ì •ê·œë¶„í¬ë¥¼ ë”°ë¥´ê¸° ë•Œë¬¸ì— ì´ì— ë”°ë¼ ì ìš©í•˜ëŠ” ë°©ë²•ë¡ ì´ë‹¤. scalingì— í‰ê· ê°’ì´ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ì´ìƒì¹˜ì˜ ì˜í–¥ì„ ë§ì´ ë°›ëŠ”ë‹¤. í‘œì¤€ ì ìˆ˜(standard score, z score)í™” í•˜ëŠ” scalingì´ê¸° ë•Œë¬¸ì— **z-score scaling**ì´ë¼ê³ ë„ ë¶€ë¥¸ë‹¤.  

`python`ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.  

```python
from sklearn.preprocessing import StandardScaler

# StandardScaling
scaler = StandardScaler()
scaler.fit(df)
df_scaled = scaler.transform(df)
df_scaled = pd.DataFrame(df_scaled, columns=df.columns)

print(df_scaled.describe())
```
```
                 x1            x2
count  1.000000e+04  1.000000e+04
mean  -4.547474e-16  4.092726e-16
std    1.000050e+00  1.000050e+00
min   -1.018266e+00 -4.967149e+00
25%   -4.246077e-01  1.269134e-02
50%   -3.044044e-01  2.670281e-01
75%   -1.716277e-01  4.953060e-01
max    3.418111e+00  1.561643e+00
```

```python
# plotting StandardScaled data
fig, axes = plt.subplots(nrows=1, ncols=3, figsize=(15, 5))
for i, ax in enumerate(axes):
    plotting(df_scaled, i, 'StandardScaled data')

plt.show()
```

![plot_rawdata](/assets/img/posts/plot_StandardScaled.png)
{:.text-center}

## MinMaxScaler

ëª¨ë“  featureì˜ ê°’ì´ 0 ~ 1 ì‚¬ì´ì— ìœ„ì¹˜í•˜ë„ë¡ ë°ì´í„°ë¥¼ scalingí•œë‹¤. ë”°ë¼ì„œ ì´ìƒì¹˜ì— ê·¹ë„ë¡œ ë¯¼ê°í•˜ì—¬ ë³€í™˜ëœ ê°’ì´ ë§¤ìš° ì¢ì€ ë²”ìœ„ë¡œ ì••ì¶•ë  ìˆ˜ ìˆë‹¤. `python`ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.  

```python
from sklearn.preprocessing import MinMaxScaler

# MinMaxScaling
scaler = MinMaxScaler()
scaler.fit(df)
df_scaled = scaler.transform(df)
df_scaled = pd.DataFrame(df_scaled, columns=df.columns)

print(df_scaled.describe())
```
```
                 x1            x2
count  10000.000000  10000.000000
mean       0.229527      0.760807
std        0.225420      0.153175
min        0.000000      0.000000
25%        0.133816      0.762751
50%        0.160911      0.801707
75%        0.190840      0.836672
max        1.000000      1.000000
```

```python
# plotting MinMaxScaled data
fig, axes = plt.subplots(nrows=1, ncols=3, figsize=(15, 5))
for i, ax in enumerate(axes):
    plotting(df_scaled, i, 'MinMaxScaled data')

plt.show()
```

![plot_rawdata](/assets/img/posts/plot_MinMaxScaled.png)
{:.text-center}

## MaxAbsScaler

ì ˆëŒ€ê°’ì´ 0 ~ 1 ì‚¬ì´ì— ìœ„ì¹˜í•˜ë„ë¡ scalingí•˜ì—¬ -1 ~ 1 ì‚¬ì´ë¡œ ì¬ì¡°ì •í•œë‹¤. ë”°ë¼ì„œ MinMaxScaler ë§ˆì°¬ê°€ì§€ë¡œ ì´ìƒì¹˜ì— ê·¹ë„ë¡œ ë¯¼ê°í•˜ë‹¤. `python`ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.  

```python
from sklearn.preprocessing import MaxAbsScaler

# MaxAbsScaling
scaler = MaxAbsScaler()
scaler.fit(df)
df_scaled = scaler.transform(df)
df_scaled = pd.DataFrame(df_scaled, columns=df.columns)

print(df_scaled.describe())
```
```
                 x1            x2
count  10000.000000  10000.000000
mean       0.513918      0.735201
std        0.142215      0.169573
min        0.369113     -0.107049
25%        0.453536      0.737353
50%        0.470629      0.780480
75%        0.489511      0.819188
max        1.000000      1.000000
```

```python
# plotting MaxAbsScaled data
fig, axes = plt.subplots(nrows=1, ncols=3, figsize=(15, 5))
for i, ax in enumerate(axes):
    plotting(df_scaled, i, 'MaxAbsScaled data')

plt.show()
```

![plot_rawdata](/assets/img/posts/plot_MaxAbsScaled.png)
{:.text-center}


## ğŸ’¡ RobustScaler

ì¤‘ì•™ê°’ê³¼ [IQR](/data_science/2022-04-01-iqr_method/)ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì´ìƒì¹˜ì˜ ì˜í–¥ì„ ëœ ë°›ëŠ”ë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤. `python`ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.  

```python
from sklearn.preprocessing import RobustScaler

# RobustScaling
scaler = RobustScaler()
scaler.fit(df)
df_scaled = scaler.transform(df)
df_scaled = pd.DataFrame(df_scaled, columns=df.columns)

print(df_scaled.describe())
```
```
                 x1            x2
count  1.000000e+04  10000.000000
mean   1.203274e+00     -0.553295
std    3.953079e+00      2.072150
min   -2.821811e+00    -10.845458
25%   -4.751494e-01     -0.526998
50%   -1.153096e-15      0.000000
75%    5.248506e-01      0.473002
max    1.471466e+01      2.682501
```

```python
# plotting RobustScaled data
fig, axes = plt.subplots(nrows=1, ncols=3, figsize=(15, 5))
for i, ax in enumerate(axes):
    plotting(df_scaled, i, 'RobustScaled data')

plt.show()
```

![plot_rawdata](/assets/img/posts/plot_RobustScaled.png)
{:.text-center}

## ê²°ê³¼ ë¹„êµ

ì „ì²´ ê²°ê³¼ë¥¼ ë¹„êµí•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤. ë°ì´í„°ì˜ ë¶„í¬ì˜ ë³€í™”ì— ì§‘ì¤‘í•´ì„œ í™•ì¸í•˜ì.  

```python
dfs = [df, df_standard_scaled, df_minmax_scaled, df_maxabs_scaled, df_robust_scaled]
titles = ['Raw data', 'StandardScaled data', 'MinMaxScaled data', 'MaxAbsScaled data', 'RobustScaled data']

fig, axes = plt.subplots(nrows=3, ncols=5, figsize=(30, 20))
for i, ax in enumerate(axes.flatten()):
    j = i % 5
    if i < 5:
        ax.boxplot(dfs[j])
        ax.set_xticks(ticks=[1, 2], labels=df.columns)
    elif 5 <= i < 10:
        ax.violinplot(dfs[j])
        ax.set_xticks(ticks=[1, 2], labels=df.columns)
    else:
        c1 = 'g'
        c2 = 'b'
        sns.kdeplot(x=dfs[j]['x1'], ax=ax, shade=True, color=c1, label='x1')
        sns.kdeplot(x=dfs[j]['x2'], ax=ax, shade=True, color=c2, label='x2')
        ax.axvline(x=dfs[j]['x1'].median(), linestyle='--', linewidth=0.5, color=c1)
        ax.axvline(x=dfs[j]['x2'].median(), linestyle='--', linewidth=0.5, color=c2)
        ax.legend()
    ax.set_xlabel('')
    ax.set_ylabel('')
    ax.set_title(titles[j])

plt.savefig(fname='plot_Scaled', bbox_inches='tight')
plt.show()
```

![plot_rawdata](/assets/img/posts/plot_Scaled.png)
{:.text-center}

ë³€í™”ëœ ë¶„í¬ë¥¼ ì›ë³¸ ë°ì´í„°ì™€ ë¹„êµí•´ë³´ë©´, `RobustScaler`ê°€ ê°€ì¥ ì´ìƒì¹˜ì˜ ì˜í–¥ì„ ì ê²Œ ë°›ì•„ ë³€í™˜ëœ ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ê³ , ë‹¤ìŒìœ¼ë¡œëŠ” `StandardScaler`ê°€ ë¹„êµì  ì´ìƒì¹˜ì˜ ì˜í–¥ì„ ì ê²Œ ë°›ëŠ” ê²°ê³¼ë¥¼ ë³´ì—¬ì¤€ë‹¤.  

---
## Reference
- [Wikipedia: Normalization (statistics)](https://en.wikipedia.org/wiki/Normalization_(statistics))
- [sklearn.preprocessing.StandardScaler](https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html#sklearn.preprocessing.StandardScaler)
- [sklearn.preprocessing.MinMaxScaler](https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html#sklearn.preprocessing.MinMaxScaler)
- [sklearn.preprocessing.MaxAbsScaler](https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MaxAbsScaler.html#sklearn.preprocessing.MaxAbsScaler)
- [sklearn.preprocessing.RobustScaler](https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.RobustScaler.html#sklearn.preprocessing.RobustScaler)
- [[Python] ì–´ë–¤ ìŠ¤ì¼€ì¼ëŸ¬ë¥¼ ì“¸ ê²ƒì¸ê°€?](https://mkjjo.github.io/python/2019/01/10/scaler.html)